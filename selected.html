<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>

  <style type="text/css">

    #container {
      margin: 10vh 20vw 10vh 10vw;
      font-family: Arial;
    }
     
    #selectors{
      width: 100%;
      background-color: red;
      margin: 0 auto;
      padding: 2% 3% 3% 12%;

    }
    .inline {
      display: inline-block;
      padding-left: 2%;
    }

    .selectorItem{
      position: relative;
      width: 20vw;
      display: inline-block;
      padding-left: 1%;
      padding-right: 1%;
      cursor: pointer;
    }

    #selector-text{
     width: 100%;
     margin: 0 auto;
     padding: 2% 5% 3% 10%;
     text-align: center;
     background-color: black;
     color: white;
    }

    #videowrapper {
      background-color: black;
      width: 100%;
      color: white;
      text-align: right;
      padding: 2% 7.5% 0 7.5%;
    }

    .hidden {
      display: none;
    }

    iframe {
      position: relative;
      margin: 4% 30% 0 20%;
    }

  </style>

  <body>

    <div id="container">
      <h1 id="selector-text"></h1>
      <div id="selectors"></div>
      <div id="videowrapper" class="hidden">
        <iframe id="videoplayer" width="560" height="349" autoplay frameborder="0"> </iframe>
      </div>
  </body>


  <script type="text/javascript">

    function parseResponse (data) {
      var results = data.components[0].config;
      var selectorText = results.views[1].text
      document.getElementById('selector-text').innerHTML = selectorText;

      var len = results.views.length

      for (var i = 2; i < len; i++) {
        var item = results.views[i]
        var videoId = results.views[i].id
        var selectorItemContainer = document.createElement('div');
        selectorItemContainer.setAttribute("id", results.views[i].id)
        selectorItemContainer.className += "selectorItem";
        document.getElementById('selectors').appendChild(selectorItemContainer);

        setTitle(item, selectorItemContainer);
        setDuration(item, selectorItemContainer);
        setThumbnail(item, selectorItemContainer);
        setDescription(item, selectorItemContainer);

        //these are just to set data attributes in the html to help pass the data.
        if (videoId == "sintel") {
          document.getElementById('sintel').setAttribute("data-videoUrl", data.components[1].config.views[1].src )
          document.getElementById('sintel').getElementsByTagName('h6')[0].setAttribute('data-actualDuration', "54000")
        }
        if (videoId == "bbb") {
          document.getElementById('bbb').setAttribute("data-videoUrl", data.components[2].config.views[4].src )
          document.getElementById('bbb').getElementsByTagName('h6')[0].setAttribute('data-actualDuration', "34000")
        }
        if (videoId == "walle") {
          document.getElementById('walle').setAttribute("data-videoUrl", data.components[3].config.views[4].src)
          document.getElementById('walle').getElementsByTagName('h6')[0].setAttribute('data-actualDuration', "152000")

        }
      }   
    };

    var setTitle = function(data, container) {
      var videoTitle = document.createElement('h3');
      videoTitle.innerHTML = data.title;
      videoTitle.className += "title inline";
      container.appendChild(videoTitle);

    }

    var setDuration = function(data, container) {
      var duration = document.createElement('h6');
      duration.innerHTML = data.duration;
      duration.className += "duration inline";
      container.appendChild(duration);
    }

    var setThumbnail = function(data, container) {
      var thumbnail = document.createElement('img');
      thumbnail.src = data.thumbnail;
      thumbnail.className += "thumbnail";
      container.appendChild(thumbnail);
    }

    var setDescription = function(data, container) {
      var description = document.createElement('h5');
      description.innerHTML = data.description;
      description.className += "description" 
      container.appendChild(description);

    }
    var ajaxRequest = function(url) {
      try {
            var script = document.createElement('script');
            script.src = url;
            document.head.appendChild(script);
          }
      catch(err){
        alert("Error loading data: " + err)
      }
    }

    ajaxRequest( "http://nymeria.sel.ec/videos_for?_sm_cb=parseResponse");


    var videowrapper = document.getElementById('videowrapper');
    var video = document.getElementsByTagName('iframe')[0];
    var selectors = document.getElementById('selectors');
    var selectorText = document.getElementById('selector-text')

    var hide = function(element) {
      element.className += ' hidden'
    }
    var show = function(element) {
      element.classList.remove('hidden')
    }

    var videoEnded = function() {
      videowrapper.removeChild(video);
      show(selectors);
      show(selectorText);
    }

    //using this method to go back to selector screen because I was having cross-domain issues with the video tag, and with accessing the video in the iframe.  This works, as long as the duration is known.  The duration wasn't accurate in the data, so I hard-coded it for demonstration purposes.  
    $('body').on("click", ".selectorItem", function(e){
      var target = e.target.parentNode;
      console.log(target)
      //This would work if the duration in the data was accurate:
      // var duration = parseFloat((this.getElementsByTagName('h6')[0].innerHTML).slice(-2)) * 1000;\
      console.log(target.getElementsByTagName('h6')[0])
      var duration = target.getElementsByTagName('h6')[0].getAttribute('data-actualDuration');
      var url = target.getAttribute("data-videoUrl");
      videowrapper.appendChild(video)
      video.src = url;
      show(videowrapper);  
      hide(selectors);
      hide(selectorText);
      console.log(duration)
      setTimeout(videoEnded, duration);
    });

</script>

</html>


